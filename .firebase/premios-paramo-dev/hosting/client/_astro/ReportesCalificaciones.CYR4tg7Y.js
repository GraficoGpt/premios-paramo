import{j as d}from"./jsx-runtime.D_zvdyIk.js";import{r as g}from"./index.BVOCwoKb.js";import{h as p,f,b as h,T as x}from"./firebase.CkSkgTuA.js";const S=a=>{if(a instanceof x){const t=a.toDate(),s=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),c=t.getFullYear(),e=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${s}/${n}/${c} ${e}:${i}`}if(typeof a=="string"){const t=new Date(a),s=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),c=t.getFullYear(),e=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`${s}/${n}/${c} ${e}:${i}`}return a},y=(a,t)=>{const s=[],n=["Fecha y hora de actualizaciÃ³n","Nombre Jurado","Correo Jurado","Nombre Proyecto","ID Proyecto","Pregunta 1","Pregunta 2","Pregunta 3","Pregunta 4","Pregunta 5","Pregunta 6","Pregunta 7","Pregunta 8","Pregunta 9","Pregunta 10","Promedio"];s.push(n.join(","));for(const o of a){const r=o.respuestas||[],u=[o.fecha,o.nombreJurado,o.juradoEmail,o.nombreProyecto,o.proyectoId,r[0]??"",r[1]??"",r[2]??"",r[3]??"",r[4]??"",r[5]??"",r[6]??"",r[7]??"",r[8]??"",r[9]??"",o.promedio??""].map(m=>`"${String(m).replace(/"/g,'\\"')}"`);s.push(u.join(","))}const c=s.join(`
`),e=new Blob([c],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(e),l=document.createElement("a");l.href=i,l.download=t,l.click()};function N(){const[a,t]=g.useState([]),[s,n]=g.useState(!0);return g.useEffect(()=>{(async()=>{const e=localStorage.getItem("votaciones_cache");if(e){t(JSON.parse(e)),n(!1);return}try{const l=(await p(f(h,"votaciones"))).docs.map(o=>({id:o.id,...o.data()}));t(l),localStorage.setItem("votaciones_cache",JSON.stringify(l))}catch(i){console.error("Error cargando votaciones:",i)}finally{n(!1)}})()},[]),s?d.jsx("p",{className:"text-center py-10",children:"Cargando calificaciones..."}):a.length===0?d.jsx("p",{className:"text-center py-10",children:"No hay calificaciones registradas."}):d.jsxs("div",{className:"max-w-6xl mx-auto p-6 space-y-6",children:[d.jsx("h2",{className:"text-2xl font-bold text-gold-600 text-center",children:"Reporte de Calificaciones de Jurados"}),d.jsx("button",{onClick:()=>{const c=a.map(e=>({...e,fecha:S(e.fecha)}));y(c,"calificaciones_jurados.csv")},className:"bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded mx-auto block",children:"Descargar CSV"}),d.jsx("p",{className:"text-center text-gray-500 mt-4 text-sm",children:"Datos cacheados en localStorage."})]})}export{N as default};
