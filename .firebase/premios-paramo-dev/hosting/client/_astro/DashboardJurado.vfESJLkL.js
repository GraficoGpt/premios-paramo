import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.BVOCwoKb.js";import{d as D,b as p,g as E,f as b,h as y,q as R,w as V}from"./firebase.CkSkgTuA.js";const L=({proyecto:a,calificacion:t,rol:n})=>e.jsxs("li",{className:"bg-white p-4 rounded shadow flex flex-col items-start relative",children:[n!=="admin"&&e.jsx("span",{className:`absolute top-4 left-4 px-2 py-1 text-xs rounded font-bold ${t?"bg-green-500 text-white":"bg-yellow-400 text-black"}`,children:t?"Calificado ✅":"Pendiente ⏳"}),e.jsx("div",{className:"w-full aspect-[4/3] overflow-hidden rounded mb-4 bg-gray-200",children:e.jsx("img",{src:a.linkImagen||"https://placehold.co/400x300",alt:`Imagen de ${a.nombreObra}`,className:"w-full h-full object-cover",loading:"lazy"})}),e.jsx("h2",{className:"font-bold text-lg mb-2",children:a.nombreObra}),e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["Postulado por: ",a.nombrePostulante]}),a.categorias&&e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["Categorías: ",Array.isArray(a.categorias)?a.categorias.join(", "):a.categorias]}),n!=="admin"&&t&&e.jsxs("div",{className:"text-xs text-gray-600 mt-2",children:[e.jsxs("p",{children:["Promedio: ",e.jsx("span",{className:"font-bold",children:t.promedio})]}),t.fecha&&e.jsxs("p",{children:["Calificado el ",t.fecha.toLocaleDateString()]})]}),e.jsx("a",{href:`/jurado/${a.id}`,className:"mt-4 bg-gold-600 text-black font-semibold px-4 py-2 rounded hover:bg-gold-700 transition w-full text-center",children:"Ver Detalle"})]}),$=()=>{const[a,t]=l.useState([]),[n,j]=l.useState([]),[N,r]=l.useState(!0),[S,w]=l.useState("jurado");if(l.useEffect(()=>{(async()=>{if(r(!0),!(typeof window>"u"))try{const o=localStorage.getItem("userEmail")||"",i=localStorage.getItem("userRol")||"jurado";if(w(i),i!=="admin"&&!o){console.error("⚠️ No se encontró email para jurado."),r(!1);return}const C=D(p,"sistema","metadata"),x=await E(C);if(!x.exists()){console.error("⚠️ No existe metadata."),r(!1);return}const f=x.data().proyectosVersion,u=JSON.parse(localStorage.getItem("proyectos")||"[]"),I=Number(localStorage.getItem("proyectosVersion"))||0;let c=[];if(u.length>0&&I===f)c=u;else{const d=b(p,"proyectos");c=(await y(d)).docs.map(m=>({id:m.id,...m.data()})),localStorage.setItem("proyectos",JSON.stringify(c)),localStorage.setItem("proyectosVersion",f.toString())}if(t(c),i!=="admin"){const d=b(p,"votaciones"),h=R(d,V("juradoEmail","==",o)),P=(await y(h)).docs.map(g=>({idProyecto:g.data().proyectoId,promedio:g.data().promedio,fecha:g.data().fecha?.toDate()||null}));j(P)}r(!1)}catch(o){console.error("❌ Error cargando datos:",o),r(!1)}})()},[]),N)return e.jsx("p",{className:"text-center py-10",children:"Cargando proyectos disponibles..."});const v=s=>n.find(o=>o.idProyecto===s);return e.jsxs("div",{className:"space-y-6 container mx-auto py-10",children:[e.jsx("h1",{className:"text-2xl font-bold text-center text-gold-600",children:"Proyectos disponibles"}),e.jsx("ul",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(s=>e.jsx(L,{proyecto:s,calificacion:v(s.id),rol:S},s.id))})]})};export{$ as default};
