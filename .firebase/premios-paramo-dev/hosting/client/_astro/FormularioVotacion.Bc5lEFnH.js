import{j as a}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.BVOCwoKb.js";import{a as j,g as y,d as g,b as u,q as F,f as J,w as N,h as U,s as T,T as Y}from"./firebase.CkSkgTuA.js";import{g as $}from"./getUserRole.CSskuUxY.js";const m=["Calidad t√©cnica del video","Narrativa o guion","Relevancia del mensaje","Creatividad","Impacto visual","Direcci√≥n","Edici√≥n","Dise√±o sonoro","Aporte a la biodiversidad","Coherencia con la categor√≠a"];function B({proyectoId:i}){const[l,E]=s.useState(Array(m.length).fill(0)),[w,S]=s.useState(!1),[D,C]=s.useState(!1),[h,c]=s.useState(""),[f,v]=s.useState(null),[p,b]=s.useState(""),[P,V]=s.useState("");s.useEffect(()=>{(async()=>{const e=j.currentUser;if(!(!e||!e.email))try{const t=await $(e.email);if(t==="jurado"){const d=await y(g(u,"jurados",e.email));d.exists()&&b(d.data().nombre)}else if(t==="admin")b("Admin");else{c("No tienes permisos para votar.");return}const o=F(J(u,"votaciones"),N("proyectoId","==",i),N("juradoEmail","==",e.email));(await U(o)).empty||C(!0);const r=await y(g(u,"proyectos",i));r.exists()&&V(r.data().nombreObra||r.data().nombreProyecto)}catch(t){console.error("Error verificando jurado o admin:",t),c("Error interno al verificar usuario.")}})()},[i]);const q=(n,e)=>{const t=parseInt(e),o=[...l];o[n]=isNaN(t)?0:t,E(o);const x=o.filter(r=>r>=1&&r<=10);if(x.length===m.length){const r=x.reduce((d,A)=>d+A,0);v(parseFloat((r/m.length).toFixed(2)))}else v(null)},R=async n=>{n.preventDefault();const e=j.currentUser;if(!e||!e.email||!p){c("Debes estar autenticado y registrado como jurado o admin.");return}if(l.includes(0)){c("Debes responder todas las preguntas.");return}const t=`${i}-${p.toLowerCase().replace(/\s+/g,"-")}`;try{await T(g(u,"votaciones",t),{proyectoId:i,nombreProyecto:P,juradoEmail:e.email,nombreJurado:p,respuestas:l,promedio:f,fecha:Y.now()}),S(!0)}catch(o){console.error(o),c("Error al guardar la votaci√≥n.")}};return D?a.jsx("p",{className:"text-green-600 font-semibold",children:"‚úÖ Ya has calificado este proyecto."}):w?a.jsx("p",{className:"text-green-600 font-semibold",children:"‚úÖ ¬°Votaci√≥n registrada correctamente!"}):a.jsxs("form",{onSubmit:R,className:"space-y-6 mt-8",children:[a.jsx("h3",{className:"text-xl font-bold text-gold-600",children:"üìù Evaluaci√≥n del Jurado"}),h&&a.jsx("p",{className:"text-red-600 font-semibold",children:h}),a.jsx("div",{className:"space-y-4",children:m.map((n,e)=>a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("label",{className:"w-full text-gray-700",children:n}),a.jsx("input",{type:"number",min:1,max:10,value:l[e]||"",onChange:t=>q(e,t.target.value),required:!0,className:"w-20 p-2 border rounded text-center"})]},e))}),f!==null&&a.jsx("div",{className:"text-right",children:a.jsxs("p",{className:"text-lg font-bold text-gold-600",children:["Promedio final: ",f]})}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition",children:"Enviar votaci√≥n"})})]})}export{B as default};
